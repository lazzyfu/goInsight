(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7aea330b"],{4047:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("a-card",{attrs:{title:"SQL工单"}},[r("div",{staticClass:"table-page-search-wrapper"},[r("a-form",{attrs:{layout:"inline",form:e.form},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch(t)}}},[r("a-row",{attrs:{gutter:[8,8]}},[r("a-col",{attrs:{md:2,sm:24}},[r("a-form-item",[r("a-switch",{staticStyle:{"margin-bottom":"1px"},attrs:{checked:e.myOrderStatus,"checked-children":"我的工单","un-checked-children":"我的工单"},on:{change:e.onMyChange}})],1)],1),r("a-col",{attrs:{md:3,sm:24}},[r("a-form-item",[r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:e.decorator["env"],expression:"decorator['env']"}],attrs:{placeholder:"环境"}},e._l(e.envs,(function(t){return r("a-select-option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1)],1),r("a-col",{attrs:{md:3,sm:24}},[r("a-form-item",[r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:e.decorator["progress"],expression:"decorator['progress']"}],attrs:{placeholder:"状态"}},e._l(e.progress,(function(t){return r("a-select-option",{key:t.key,attrs:{value:t.key}},[e._v(e._s(t.value))])})),1)],1)],1),r("a-col",{attrs:{md:4,sm:24}},[r("a-form-item",[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:e.decorator["search"],expression:"decorator['search']"}],attrs:{placeholder:"输入要查询的工单内容"}})],1)],1),r("a-col",{attrs:{md:5,sm:24}},[r("a-form-item",[r("a-range-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:e.decorator["created_at"],expression:"decorator['created_at']"}]})],1)],1),r("a-col",{attrs:{md:4,sm:24}},[r("span",{staticClass:"table-page-search-submitButtons"},[r("a-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),r("a-button",{staticStyle:{"margin-left":"8px"},on:{click:e.resetForm}},[e._v("重置")])],1)])],1)],1)],1),r("a-table",{attrs:{columns:e.table.columns,rowKey:function(e){return e.id},dataSource:e.table.data,pagination:e.pagination,loading:e.loading,size:"middle",scroll:{x:1100}},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"progress",fn:function(t){return r("span",{},e._l(e.progress,(function(n){return r("div",{key:n.value},[n.value===t?r("el-button",{attrs:{size:"small",round:"",plain:"",type:n.color}},[e._v(e._s(t))]):e._e()],1)})),0)}},{key:"applicant",fn:function(t,n){return r("span",{},[r("el-tooltip",{attrs:{placement:"right-end",effect:"light"}},[r("div",{attrs:{slot:"content"},slot:"content"},["ON"===n.is_hide?r("span",[e._v(" 仅有查看权限且仅工单的提交人、审核人、复核人和DBA可以查看工单内容 ")]):r("span",[e._v(" 有查看权限的用户可以查看当前工单内容 ")])]),"ON"===n.is_hide?r("i",{staticClass:"el-icon-lock table-msg",staticStyle:{color:"#52c41a"}}):r("i",{staticClass:"el-icon-lock table-msg"})]),e._v(" "+e._s(t)+" ")],1)}},{key:"department",fn:function(t){return r("span",{},e._l(t.split(","),(function(t){return r("div",{key:t},[r("span",[e._v(e._s(t))])])})),0)}},{key:"escape_title",fn:function(t,n){return r("span",{},[r("router-link",{attrs:{to:{name:"view.sqlorders.detail",params:{order_id:n.order_id}}}},[e._v(e._s(t))]),r("br"),e._v(" At: "+e._s(n.created_at)+" ")],1)}},{key:"host",fn:function(t,n){return r("span",{},[e._v(" "+e._s(n.host)+":"+e._s(n.port)+" "),r("br"),e._v(" "+e._s(n.database)+" ")])}},{key:"version",fn:function(t){return[t?r("span",[r("router-link",{attrs:{to:{name:"view.sqlorders.version.view",params:{version:t}}}},[e._v(e._s(t))])],1):r("span",[e._v("-")])]}},{key:"auditor",fn:function(t){return r("span",{},e._l(JSON.parse(t),(function(t){return r("div",{key:t.user+t.status},[r("span",{style:{color:0===t.status?"#f56c6c":"#67c23a"}},[t.display_name?r("span",[e._v(e._s(t.display_name))]):r("span",[e._v(e._s(t.user))])])])})),0)}},{key:"reviewer",fn:function(t){return r("span",{},e._l(JSON.parse(t),(function(t){return r("div",{key:"reviewer_"+t.user+t.status},[r("span",{style:{color:0===t.status?"#f56c6c":"#67c23a"}},[t.display_name?r("span",[e._v(e._s(t.display_name))]):r("span",[e._v(e._s(t.user))])])])})),0)}}])})],1)},a=[],s=(r("d3b7"),r("ac1f"),r("841c"),r("5530")),o=r("c1df"),u=r.n(o),i=r("4ad3"),c=r("7125"),l=r("5880"),d={computed:Object(s["a"])({},Object(l["mapGetters"])(["sqlState"])),data:function(){return{loading:!1,myOrderStatus:!1,timer:"",username:"",envs:0,progress:c["c"],confirmMsg:"",visible:!1,pagination:{current:1,pageSize:10,total:0,pageSizeOptions:["5","10","20"],showSizeChanger:!0},filter:{},filterDisabledBtn:["已勾住","未通过","已关闭"],table:{columns:null,data:null},decorator:{env:["env",{rules:[{required:!1}]}],progress:["progress",{rules:[{required:!1}]}],search:["search",{rules:[{required:!1}]}],created_at:["created_at",{rules:[{required:!1}]}]},form:this.$form.createForm(this)}},methods:Object(s["a"])(Object(s["a"])({},Object(l["mapActions"])(["storeMyOrder"])),{},{getEnvs:function(){var e=this;i["j"].then((function(t){e.envs=t.data}))},onMyChange:function(e){this.storeMyOrder(e?"ON":"OFF"),this.username="","ON"==this.sqlState.orders.my_order?(this.myOrderStatus=!0,this.username=this.$store.getters.userInfo.username):this.myOrderStatus=!1,this.pagination.current=1,this.pagination.pageSize=10,this.pagination.total=0,this.fetchData()},handleTableChange:function(e){this.pagination.current=e.current,this.pagination.pageSize=e.pageSize,this.fetchData()},fetchData:function(){var e=this,t=Object(s["a"])({page_size:this.pagination.pageSize,page:this.pagination.current,username:this.username},this.filters);this.loading=!0,Object(i["n"])(t).then((function(t){e.pagination.total=t.count,e.loading=!1,e.table.columns=t.results.columns,e.table.data=t.results.data})).finally((function(){e.loading=!1}))},handleSearch:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,r){e||(t.filters={progress:r["progress"],search:r["search"],env:r["env"],start_created_at:r["created_at"]?u()(r["created_at"][0]).format("YYYY-MM-DD"):void 0,end_created_at:r["created_at"]?u()(r["created_at"][1]).format("YYYY-MM-DD"):void 0},t.pagination.current=1,t.fetchData())}))},resetForm:function(){this.form.resetFields()}}),destroyed:function(){clearInterval(this.timer)},mounted:function(){var e=this;this.getEnvs(),"ON"==this.sqlState.orders.my_order&&(this.myOrderStatus=!0,this.username=this.$store.getters.userInfo.username),this.fetchData(),this.timer&&clearInterval(this.timer),this.timer=setInterval((function(){setTimeout(e.fetchData(),0)}),3e4)}},f=d,m=(r("6667"),r("2877")),p=Object(m["a"])(f,n,a,!1,null,null,null);t["default"]=p.exports},"4ad3":function(e,t,r){"use strict";r.d(t,"s",(function(){return a})),r.d(t,"j",(function(){return s})),r.d(t,"l",(function(){return o})),r.d(t,"k",(function(){return u})),r.d(t,"t",(function(){return i})),r.d(t,"c",(function(){return c})),r.d(t,"n",(function(){return l})),r.d(t,"m",(function(){return d})),r.d(t,"v",(function(){return f})),r.d(t,"i",(function(){return m})),r.d(t,"q",(function(){return p})),r.d(t,"o",(function(){return h})),r.d(t,"p",(function(){return v})),r.d(t,"h",(function(){return g})),r.d(t,"g",(function(){return _})),r.d(t,"r",(function(){return y})),r.d(t,"b",(function(){return k})),r.d(t,"a",(function(){return b})),r.d(t,"f",(function(){return q})),r.d(t,"u",(function(){return w})),r.d(t,"d",(function(){return O})),r.d(t,"w",(function(){return S})),r.d(t,"e",(function(){return x})),r.d(t,"x",(function(){return D}));r("99af");var n=r("b775"),a=n["b"].request({url:"/users/list",method:"get"}),s=n["b"].request({url:"/sqlorders/envs",method:"get"}),o=n["b"].request({url:"/sqlorders/versions/get",method:"get"}),u=function(e){return n["b"].request({url:"/sqlorders/schemas",method:"get",params:e})},i=function(e){return n["b"].request({url:"/sqlorders/incep/syntaxcheck",method:"post",data:e})},c=function(e){return n["b"].request({url:"/sqlorders/commit",method:"post",data:e})},l=function(e){return n["b"].request({url:"/sqlorders/list",method:"get",params:e})},d=function(e){return n["b"].request({url:"/sqlorders/detail/".concat(e),method:"get"})},f=function(e){return n["b"].request({url:"/sqlorders/op/".concat(e.action,"/").concat(e.pk),method:"put",data:e})},m=function(e){return n["b"].request({url:"/sqlorders/tasks/generate",method:"post",data:e})},p=function(e){return n["b"].request({url:"/sqlorders/tasks/preview/".concat(e.task_id),method:"get",params:e})},h=function(e){return n["b"].request({url:"/sqlorders/tasks/get/".concat(e.order_id),method:"get",params:e})},v=function(e){return n["b"].request({url:"/sqlorders/tasks/list/".concat(e.task_id),method:"get",params:e})},g=function(e){return n["b"].request({url:"/sqlorders/tasks/execute/single",method:"post",data:e})},_=function(e){return n["b"].request({url:"/sqlorders/tasks/execute/multi",method:"post",data:e})},y=function(e){return n["b"].request({url:"/sqlorders/tasks/result/".concat(e),method:"get"})},k=function(e){return n["b"].request({url:"/sqlorders/tasks/throttle",method:"post",data:e})},b=function(e){return n["b"].request({url:"/sqlorders/hook",method:"post",data:e})},q=function(e){return n["b"].request({url:"/sqlorders/export/download/".concat(e),method:"get",responseType:"blob"})},w=function(e){return n["b"].request({url:"/sqlorders/versions/list",method:"get",params:e})},O=function(e){return n["b"].request({url:"/sqlorders/versions/create",method:"post",data:e})},S=function(e){return n["b"].request({url:"/sqlorders/versions/update/".concat(e.key),method:"put",data:e})},x=function(e){return n["b"].request({url:"/sqlorders/versions/delete/".concat(e),method:"delete",data:e})},D=function(e){return n["b"].request({url:"/sqlorders/versions/view/".concat(e),method:"get",params:e})}},6667:function(e,t,r){"use strict";var n=r("8fc8"),a=r.n(n);a.a},7125:function(e,t,r){"use strict";r.d(t,"d",(function(){return n})),r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return o})),r.d(t,"e",(function(){return u}));var n=[{key:1,value:"mysql"},{key:2,value:"tidb"}],a=["立即执行","上线执行"],s=[{key:"xlsx",value:"xlsx"},{key:"csv",value:"csv"}],o=[{key:0,value:"待审核",color:"warning"},{key:1,value:"已驳回",color:"danger"},{key:2,value:"已批准",color:"primary"},{key:3,value:"处理中",color:"warning"},{key:4,value:"已完成",color:"success"},{key:5,value:"已关闭",color:"danger"},{key:6,value:"已复核",color:"info"},{key:7,value:"已勾住",color:"default"}],u=[{key:0,value:"未执行"},{key:1,value:"已完成"},{key:2,value:"处理中"},{key:3,value:"失败"},{key:4,value:"异常"}]},"8fc8":function(e,t,r){}}]);